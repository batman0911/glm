---
title: "chap_9"
author: "linhnm"
date: "5/16/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

ex turbines
```{r}
data("turbines"); str(turbines)

tur.m1 <- glm(Fissures / Turbines ~ Hours, weights = Turbines, data = turbines, family = binomial())
tur.m2 <- update(tur.m1, family = binomial(link = "probit"))
tur.m3 <- update(tur.m1, family = binomial(link = "cloglog"))

summary(tur.m1)
```

compare 3 link func
```{r}

tr.array <- rbind(coef(tur.m1), coef(tur.m2), coef(tur.m3))
tr.array <- cbind(tr.array, c(deviance(tur.m1), deviance(tur.m2), deviance(tur.m3)))

colnames(tr.array) = c("Intercept", "Hours", "Residual deviation")
rownames(tr.array) = c("Logit", "Probit", "C log-log")

tr.array

#summary(tur.m1)
```

goodness of fit test for deviance
```{r}
resQ <- qresid(tur.m1)
qqnorm(resQ)
qqline(resQ)

```
calculate ED50
```{r}
ED50 <- cbind("logit" = dose.p(tur.m1), "probit" = dose.p(tur.m2), "c-log-log" = dose.p(tur.m3))
ED50
```
check lack of fit
```{r}
c(Df = df.residual(tur.m1), Resid.Dev = deviance(tur.m1), pearson.x2 = sum(resid(tur.m1, type = "pearson")^2))
```
wald test
```{r}
wald.test(Sigma = vcov(tur.m1), b = coef(tur.m1), Tearms = c(1))
```



ex germ
```{r}
data("germ"); str(germ)

fit <- glm(Germ / Total ~ Extract * Seeds, weights = Total, data = germ, family = binomial(link = "logit"))
summary(fit)
wald.test(Sigma = vcov(fit), b = coef(fit), Terms = 1:3)
confint(fit)

-0.4122 - qnorm(0.975) * 0.1842
-0.4122 + qnorm(0.975) * 0.1842
#exp(coef(fit))
```

pr 9.6

```{r}
betaM <- c(0.45, 0.04, 0.25, 0.23)
seM <- c(0.4, 0.08, 0.15, 0.17)
betaF <- c(-0.22, 0.26, 0.82, -0.22)
seF <- c(0.53, 0.06, 0.19, 0.11)
zM <- betaM / seM
zF <- betaF / seF
pvalM <- (1 - pnorm(abs(zM))) * 2
pvalF <- (1 - pnorm(abs(zF))) * 2

cbind("male beta" = betaM, "male p-value" = pvalM)
cbind("female beta" = betaF, "female p-value" = pvalF)
```


